trigger:
  - master

pool:
  vmImage: 'ubuntu-latest'

variables:
  nugetFeed: "Monorepo/ProtoPackagesMonorepo"

steps:
  - task: UseDotNet@2
    inputs:
      packageType: 'sdk'
      version: '3.x'

  - task: PowerShell@2
    condition: contains(variables['Build.Repository.Name'], 'repo')
    inputs:
      filePath: build-nuget.ps1
      arguments: >
        -repositoryName $(Build.Repository.Name)

  - task: NuGetAuthenticate@0
    displayName: 'NuGet Authenticate'

  - task: NuGetCommand@2
    displayName: 'NuGet push'
    inputs:
      command: push
      packagesToPush: $(System.DefaultWorkingDirectory)/**/*.nupkg;!$(System.DefaultWorkingDirectory)/**/*.symbols.nupkg
      publishVstsFeed: $(nugetFeed)
      allowPackageConflicts: true



